{% extends "base.html" %}
{% block content %}
<div class="container" style="padding-top:10px; width:100%">
  <div class="row">
    <form class="form-inline">
      <label for="time">When:</label>
      <div class="col">
	<select class="form-control" id="exampleFormControlSelect2" name="t" value="0">
	  <option value="-1">Live</option>
	  {% for time in times %}
	  <option value="{{ time }}"
		    {% if time==this_time %}
		  selected="selected"
		  {% endif %}
		  >
	    {{ format_time(time) }}</option>
	    {% endfor %}
	</select>
      </div>
      <label for="time">Number of posts:</label>
      <div class="col">
	<input type="text" class="form-control" placeholder="{{ k }}" name="k" value="{{ k }}">
      </div>
      <div class="col">
	<button type="submit" class="btn btn-primary float-right" action="#" method="get">Reload</button>
      </div>
    </form>
  </div>
  <br>
  <div class="row" style="width: 100%">
    <p>Viewing conversations in the {{ format_duration(duration) }} before {{ format_time(this_time) }}. </p>
  </div>
  <div class="row" style="width: 100%">
    <p>{{ distrib[0] }} / {{ distrib[1] }} conversations predicted to derail
      {% if distrib[1] > 0 %}
      ({{ (distrib[0] / distrib[1] * 100) | round(2) }} %).
      {% endif %}
    </p>
  </div>
  <div class="row" style="width: 100%">
    <table class="table table-striped table-hover">
      <h3>Top {{ k }} most likely to derail conversations:</h3>
      {% if this_time != -1 %}
      <tr>
	<th colspan="5" scope="col">At {{ format_time(this_time) }}</th>
	<th colspan="5" scope="col">Since {{ format_time(this_time) }}</th>
      </tr>
      {% endif %}
      <tr>
	<th scope="col">Rank</th>
	<th scope="col">CRAFT Score</th>
	<th scope="col">Score Change</th>
	<th scope="col">Number of Comments</th>
	<th scope="col">Post Name</th>
	{% if this_time != -1 %}
	<th scope="col">Number of New Comments</th>
	<th scope="col">Has the conversation derailed?</th>
	<th scope="col">Still Active?</th>
	{% endif %}
      </tr>
      {% for rank in ranks %}
      <tr class="clickable-row" data-href="{{ url_for('routes.convo', id=rank[1]) }}" style="cursor: pointer">
	<th scope="row">{{ loop.index  }}</th>
	<td
	  {% if rank[0] > craft_thresh %}
	  style="background: red"
	  {% endif %} >
	  
	  {{ rank[0] | round(3) }}
	</td>
	<td>
	  {% if rank[2] > arrow_thresh %}
	  <span style="color:red; font-size:200%">&#10138;</span>
	  {% elif rank[2] > 0 %}
	  <span style="color:red">&#10138;</span>
	  {% elif rank[2] == 0 %}
	  <span style="color:yellow">&#10137;</span>
	  {% elif rank[2] > - arrow_thresh %}
	  <span style="color:green">&#10136;</span>
	  {% else %}
	  <span style="color:green; font-size:200%">&#10136;</span>
	  {% endif %}
	  <!-- {{ rank[2] | round(3) }} -->
	</td>
	<td>{{ rank[3] }}</td>
	<td>{{ rank[4] }}</td>
	{% if this_time != -1 %}
	<td>{{ rank[5] }}</td>
	<td>{{ rank[6] }}</td>
	<td>{{ rank[7] }}</td>
	{% endif %}
      </tr>
      {% endfor %}
    </table>
  </div>
</div>



{% endblock %}
